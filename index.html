<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Thumbnails MLOps</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Inter:wght@400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Hero Section -->
    <section class="hero-architecture">
        <!-- SVG Layer for Curved Connections -->
        <svg id="connections-layer"></svg>

        <div class="arch-grid-complex">
            <!-- Node 1: Collection -->
            <div class="node-wrapper" style="grid-area: col;">
                <div class="node-box" id="node-collection" data-tech="Python">
                    <i class="fas fa-terminal"></i>
                    <span>Collection<br>Pipeline</span>
                </div>
            </div>

            <!-- Node 2: S3 -->
            <div class="node-wrapper" style="grid-area: s3;">
                <div class="node-box" id="node-s3" data-tech="S3/R2">
                    <i class="fas fa-cloud"></i>
                    <span>Object<br>Storage</span>
                </div>
            </div>

            <!-- Node 3: DVC -->
            <div class="node-wrapper" style="grid-area: dvc;">
                <div class="node-box" id="node-dvc" data-tech="Git Ops">
                    <i class="fas fa-code-branch"></i>
                    <span>DVC<br>Dataset</span>
                </div>
            </div>

            <!-- Node 4: Training -->
            <div class="node-wrapper" style="grid-area: train;">
                <div class="node-box" id="node-train" data-tech="PyTorch">
                    <i class="fas fa-brain"></i>
                    <span>Training<br>Pipeline</span>
                </div>
            </div>

            <!-- Node 5: W&B -->
            <div class="node-wrapper" style="grid-area: wb;">
                <div class="node-box" id="node-wb" data-tech="MLOps">
                    <i class="fas fa-chart-line"></i>
                    <span>Weights &<br>Biases</span>
                </div>
            </div>

            <!-- Node 8: Human / Analytics (Above W&B) -->
            <div class="node-wrapper" style="grid-area: human;">
                <div class="node-box" id="node-human" data-tech="Team">
                    <i class="fas fa-user-astronaut"></i>
                    <span>Analytics &<br>Selection</span>
                </div>
            </div>

            <!-- Node 6: Browser Inference (Right) -->
            <div class="node-wrapper" style="grid-area: inf;">
                <div class="inference-box" id="node-inf">
                    <div class="inf-header">
                        <i class="fab fa-chrome"></i> Browser (Static Client)
                    </div>

                    <div class="inf-preview" onclick="triggerUpload(this)">
                        <div class="placeholder">
                            <i class="fas fa-image"></i>
                            <span>Upload Thumbnail</span>
                        </div>
                        <img src="" alt="Preview" class="preview-img" style="display: none;">
                    </div>

                    <div class="inf-controls">
                        <div class="inf-info"><small>Runs on User Laptop (ONNX)</small></div>
                        <button class="btn-predict" onclick="simulatePrediction()">
                            <i class="fas fa-bolt"></i> Predict score
                        </button>
                    </div>

                    <div class="inf-result" id="inf-result" style="display: none;">
                        <span class="score-badge">--</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Sample Thumbnails to simulate upload
        const SAMPLES = [
            'https://img.youtube.com/vi/7T10n1jBeIA/maxresdefault.jpg', // MLOps video
            'https://img.youtube.com/vi/2eWuYf-aZE4/maxresdefault.jpg', // Another tech video
        ];

        function triggerUpload(el) {
            const img = el.querySelector('.preview-img');
            const placeholder = el.querySelector('.placeholder');

            // Random sample
            const sample = SAMPLES[Math.floor(Math.random() * SAMPLES.length)];

            img.src = sample;
            img.style.display = 'block';
            placeholder.style.display = 'none'; // Hide placeholder

            // Add 'uploaded' state style
            el.classList.add('has-image');
        }

        function simulatePrediction() {
            const btn = document.querySelector('.btn-predict');
            const resultBox = document.getElementById('inf-result');
            const scoreBadge = resultBox.querySelector('.score-badge');
            const preview = document.querySelector('.inf-preview');

            if (!preview.classList.contains('has-image')) {
                alert("Upload a thumbnail first!");
                return;
            }

            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            btn.disabled = true;
            resultBox.style.display = 'none';

            setTimeout(() => {
                const score = (Math.random() * (9.9 - 7.0) + 7.0).toFixed(1); // 7.0 to 9.9
                btn.innerHTML = '<i class="fas fa-bolt"></i> Predict score';
                btn.disabled = false;

                scoreBadge.textContent = score;
                // Color code
                if (score > 9) scoreBadge.style.background = 'var(--accent-cyan)';
                else scoreBadge.style.background = 'var(--accent-pink)'; // Good but not great

                resultBox.style.display = 'flex';

                // Trigger visual "pulse" on W&B connection
                // (Could add class to SVG line here)
                drawConnections();
            }, 1000);
        }

        // --- Improved Connection Logic with Vertical Support ---
        function drawConnections() {
            const svg = document.getElementById('connections-layer');
            const container = document.querySelector('.hero-architecture');
            if (!svg || !container) return;

            while (svg.firstChild) { svg.removeChild(svg.firstChild); }
            const cRect = container.getBoundingClientRect();

            function getCenter(id) {
                const el = document.getElementById(id);
                if (!el) return null;
                const r = el.getBoundingClientRect();
                return {
                    x: (r.left + r.width / 2) - cRect.left,
                    y: (r.top + r.height / 2) - cRect.top,
                    w: r.width, h: r.height,
                    top: r.top - cRect.top,
                    bottom: r.bottom - cRect.top,
                    left: r.left - cRect.left,
                    right: r.right - cRect.left
                };
            }

            function drawPath(id1, id2, type = 'curve', label = null, labelOffset = { x: 0, y: 0 }) {
                const p1 = getCenter(id1);
                const p2 = getCenter(id2);
                if (!p1 || !p2) return;

                let d = '';
                // Default label position (midpoint)
                let lx = (p1.x + p2.x) / 2;
                let ly = (p1.y + p2.y) / 2;

                if (type === 'curve') {
                    const deltaX = p2.x - p1.x;
                    const c1x = p1.x + deltaX * 0.5;
                    const c2x = p2.x - deltaX * 0.5;
                    d = `M ${p1.x} ${p1.y} C ${c1x} ${p1.y}, ${c2x} ${p2.y}, ${p2.x} ${p2.y}`;
                    // Curve midpoint calculation is complex, but geometric mid is usually okay with offset.
                    // Let's bias Y up slightly for curves that dip.
                    ly = p1.y + (p2.y - p1.y) * 0.5;
                    if (Math.abs(p1.y - p2.y) < 20) ly -= 10; // If mostly horizontal, push label up

                } else if (type === 'step') {
                    const midY = (p1.y + p2.y) / 2;
                    d = `M ${p1.x} ${p1.y} L ${p1.x} ${midY} L ${p2.x} ${midY} L ${p2.x} ${p2.y}`;

                    // For 'step', place label on the horizontal bar
                    lx = (p1.x + p2.x) / 2;
                    ly = midY - 5;

                } else if (type === 'straight') {
                    d = `M ${p1.x} ${p1.bottom} L ${p2.x} ${p2.top}`;
                    ly = (p1.bottom + p2.top) / 2;
                    lx = (p1.x + p2.x) / 2;

                } else if (type === 'loop') {
                    // Centered Loop: Arch above the box
                    const startX = p1.x;
                    const startY = p1.top;
                    // Draw a loop that goes up-left, curves around top, comes down-right
                    d = `M ${startX - 10} ${startY} 
                          C ${startX - 40} ${startY - 30}, ${startX - 40} ${startY - 50}, ${startX} ${startY - 50}
                          C ${startX + 40} ${startY - 50}, ${startX + 40} ${startY - 30}, ${startX + 10} ${startY}`;

                    lx = startX;
                    ly = startY - 55; // On top of the loop
                }

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', d);
                path.setAttribute('class', 'connection-line');
                if (type === 'straight') path.style.strokeDasharray = "5,5";
                svg.appendChild(path);

                const packet = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                packet.setAttribute('r', '3');
                packet.setAttribute('class', 'connection-packet');
                const anim = document.createElementNS('http://www.w3.org/2000/svg', 'animateMotion');
                anim.setAttribute('dur', '2s');
                anim.setAttribute('repeatCount', 'indefinite');
                anim.setAttribute('path', d);
                packet.appendChild(anim);
                svg.appendChild(packet);

                if (label) {
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');

                    // Apply Manual Offset
                    lx += labelOffset.x;
                    ly += labelOffset.y;

                    text.setAttribute('x', lx);
                    text.setAttribute('y', ly);
                    text.setAttribute('class', 'connection-label');
                    text.setAttribute('text-anchor', 'middle');

                    // Add background rect? For now just text.
                    text.textContent = label;
                    svg.appendChild(text);
                }
            }

            // Draw all
            drawPath('node-collection', 'node-collection', 'loop', 'Daily Cron');
            drawPath('node-collection', 'node-s3', 'curve', 'Raw', { x: 0, y: -5 });

            // S3 -> WB
            drawPath('node-s3', 'node-wb', 'curve', 'Visualization', { x: 0, y: -5 });

            drawPath('node-s3', 'node-dvc', 'step');

            // DVC -> Train: "On New Dataset Release". 'step' puts it on midY horizontal.
            // User wants it "more on left".
            drawPath('node-dvc', 'node-train', 'step', 'On New Dataset Release', { x: -30, y: -5 });

            drawPath('node-train', 'node-wb', 'curve', 'Register', { x: 0, y: -5 });

            // Human -> WB
            drawPath('node-human', 'node-wb', 'straight', 'Promote to Prod', { x: 10, y: 0 });

            // WB -> Inf: 'Deploy Static'. Center it.
            drawPath('node-wb', 'node-inf', 'step', 'Deploy', { x: 0, y: -5 });
        }


        // Wait for layout to be stable
        window.addEventListener('load', () => {
            requestAnimationFrame(drawConnections);
        });
        window.addEventListener('resize', () => {
            requestAnimationFrame(drawConnections);
        });
        // Periodic check to ensure they don't disappear
        setInterval(drawConnections, 2000);
    </script>
</body>