<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Thumbnails MLOps</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Inter:wght@400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="glass-nav">
        <div class="logo-area" style="display: flex; flex-direction: column;">
            <div class="logo">
                <span class="gradient-text">YouTube</span> MLOps
            </div>
            <div style="font-size: 0.75rem; color: var(--text-secondary); opacity: 0.8; font-weight: 400;">
                End-to-end Continous Learning Pipeline
            </div>
            <div style="font-size: 0.7rem; color: var(--text-secondary); opacity: 0.6; margin-top: 2px;">
                Made by <a href="https://www.linkedin.com/in/daniele-acquaviva/" target="_blank"
                    style="color: inherit; text-decoration: underline;">Daniele Acquaviva</a>
            </div>
        </div>
        <div class="links">
            <a href="https://github.com/youtube-thumbnails-mlops" target="_blank" class="btn-sm">
                <i class="fab fa-github"></i> GitHub Repo
            </a>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-architecture">
        <!-- SVG Layer for Curved Connections -->
        <svg id="connections-layer"></svg>

        <div class="arch-grid-complex">
            <!-- Node 1: Collection -->
            <div class="node-wrapper" style="grid-area: col;">
                <div class="node-box" id="node-collection" data-tech="Python">
                    <i class="fas fa-terminal"></i>
                    <span>Collection<br>Pipeline</span>
                </div>
            </div>

            <!-- Node New: YouTube (Under Collection) -->
            <div class="node-wrapper" style="grid-area: yt;">
                <div class="node-box cloud" id="node-yt" data-tech="Source">
                    <i class="fab fa-youtube" style="color: #FF0000;"></i>
                    <span>YouTube</span>
                </div>
            </div>

            <!-- Node New: Container Registry (Left of Training) -->
            <div class="node-wrapper" style="grid-area: reg;">
                <div class="node-box cloud" id="node-reg" data-tech="Docker Hub">
                    <i class="fab fa-docker"></i>
                    <span>Container<br>Registry</span>
                </div>
            </div>

            <!-- Node 2: S3 -->
            <div class="node-wrapper" style="grid-area: s3;">
                <div class="node-box cloud" id="node-s3" data-tech="S3/R2">
                    <i class="fas fa-cloud"></i>
                    <span>Object<br>Storage</span>
                </div>
            </div>

            <!-- Node 3: DVC -->
            <div class="node-wrapper" style="grid-area: dvc;">
                <div class="node-box" id="node-dvc" data-tech="Git Ops">
                    <i class="fas fa-code-branch"></i>
                    <span>DVC<br>Dataset</span>
                </div>
            </div>

            <!-- Node 4: Training -->
            <div class="node-wrapper" style="grid-area: train;">
                <div class="node-box" id="node-train" data-tech="PyTorch">
                    <i class="fas fa-brain"></i>
                    <span>Training<br>Pipeline</span>
                </div>
            </div>

            <!-- Node 9: RunPod (Under Training) -->
            <div class="node-wrapper" style="grid-area: runpod;">
                <div class="node-box cloud" id="node-runpod" data-tech="GPU Cloud">
                    <i class="fas fa-server"></i>
                    <span>RunPod<br>GPU</span>
                </div>
            </div>

            <!-- Node 5: W&B -->
            <div class="node-wrapper" style="grid-area: wb;">
                <div class="node-box cloud" id="node-wb" data-tech="MLOps">
                    <i class="fas fa-chart-line"></i>
                    <span>Weights &<br>Biases</span>
                </div>
            </div>

            <!-- Node 8: Testing Pipeline (Above W&B) -->
            <div class="node-wrapper" style="grid-area: human;">
                <div class="node-box" id="node-human" data-tech="CI/CD">
                    <i class="fas fa-check-circle"></i>
                    <span>Testing<br>Pipeline</span>
                </div>
            </div>

            <!-- Node New: Monitoring (Right of Testing) -->
            <div class="node-wrapper" style="grid-area: mon;">
                <div class="node-box cloud" id="node-mon" data-tech="Slack/Email">
                    <i class="fas fa-bell"></i>
                    <span>Monitoring<br>& Alerts</span>
                </div>
            </div>

            <!-- Node 6: Browser Inference (Right) -->
            <div class="node-wrapper" style="grid-area: inf;">
                <div class="inference-box" id="node-inf">

                    <!-- Desktop File Input -->
                    <div class="inf-preview" onclick="document.getElementById('file-upload-desktop').click()">
                        <div class="placeholder">
                            <i class="fas fa-image"></i>
                            <span>Upload Thumbnail</span>
                        </div>
                        <img src="" alt="Preview" class="preview-img" style="display: none;">
                        <input type="file" id="file-upload-desktop" accept="image/*" hidden
                            onchange="handleFileSelect(this)">
                    </div>

                    <div class="inf-controls-top" style="margin-bottom: 1rem;">
                        <input type="text" placeholder="Title..." class="inf-text">
                    </div>

                    <div class="inf-controls">
                        <div class="inf-info"><small>Runs on User Laptop (ONNX)</small></div>
                        <button class="btn-predict" onclick="simulatePrediction(this)">
                            <i class="fas fa-bolt"></i> Predict score
                        </button>
                    </div>

                    <div class="inf-result" id="inf-result" style="display: none;">
                        <span class="score-badge">--</span>
                    </div>
                </div>
            </div>
        </div>
        </div>
        </div>
    </section>

    <!-- Mobile View -->
    <section class="mobile-view" style="display: none;">
        <div class="mobile-container">
            <!-- 1. Inference Box First -->
            <div class="inference-box mobile-inf-box">

                <!-- Mobile File Input -->
                <div class="inf-preview" onclick="document.getElementById('file-upload-mobile').click()">
                    <div class="placeholder">
                        <i class="fas fa-image"></i>
                        <span>Upload Thumbnail</span>
                    </div>
                    <img src="" alt="Preview" class="preview-img" style="display: none;">
                    <input type="file" id="file-upload-mobile" accept="image/*" hidden
                        onchange="handleFileSelect(this)">
                </div>

                <div class="inf-controls-top" style="margin-bottom: 1rem;">
                    <input type="text" placeholder="Title..." class="inf-text">
                </div>

                <div class="inf-controls">
                    <div class="inf-info"><small>Runs on User Laptop (ONNX)</small></div>
                    <button class="btn-predict" onclick="simulatePrediction(this)">
                        <i class="fas fa-bolt"></i> Predict score
                    </button>
                </div>

                <div class="inf-result" class="inf-result" style="display: none;">
                    <span class="score-badge">--</span>
                </div>
            </div>

            <!-- 2. Title -->
            <h2 class="mobile-title" style="margin-top: 1rem;">MLOps Architecture</h2>

            <!-- 3. Image (Click triggers modal) -->
            <div class="mobile-diagram-img" onclick="openModal()">
                <img src="assets/diagram-mobile.png" alt="MLOps Architecture Diagram">
                <div class="tap-hint"><i class="fas fa-search-plus"></i> Tap to Zoom</div>
            </div>
        </div>
    </section>

    <!-- Image Modal -->
    <div id="imgModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <img class="modal-content" id="img01" src="assets/diagram-mobile.png">
    </div>

    <script>
        // Modal Logic
        function openModal() {
            document.getElementById('imgModal').style.display = "block";
        }

        function closeModal() {
            document.getElementById('imgModal').style.display = "none";
        }

        // Close modal if user clicks outside image
        window.onclick = function (event) {
            const modal = document.getElementById('imgModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Helper to handle file selection
        function handleFileSelect(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                const container = input.closest('.inf-preview');

                reader.onload = function (e) {
                    const img = container.querySelector('.preview-img');
                    const placeholder = container.querySelector('.placeholder');

                    img.src = e.target.result;
                    img.style.display = 'block';
                    placeholder.style.display = 'none';
                    container.classList.add('has-image');
                }

                reader.readAsDataURL(input.files[0]);
            }
        }

        function simulatePrediction(btn) {
            // Find parent container
            const container = btn.closest('.inference-box');
            const resultBox = container.querySelector('.inf-result');
            const scoreBadge = container.querySelector('.score-badge');
            const preview = container.querySelector('.inf-preview');

            if (!preview.classList.contains('has-image')) {
                alert("Upload a thumbnail first!");
                return;
            }

            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            btn.disabled = true;
            resultBox.style.display = 'none';

            setTimeout(() => {
                const score = (Math.random() * (9.9 - 7.0) + 7.0).toFixed(1); // 7.0 to 9.9
                btn.innerHTML = originalText;
                btn.disabled = false;

                scoreBadge.textContent = score;
                // Color code
                if (score > 9) scoreBadge.style.background = 'var(--accent-cyan)';
                else scoreBadge.style.background = 'var(--accent-pink)'; // Good but not great

                resultBox.style.display = 'flex';

                // Trigger visual "pulse" on W&B connection only if on desktop
                if (window.innerWidth > 900) {
                    drawConnections();
                }
            }, 1000);
        }

        // --- Improved Connection Logic with Vertical Support ---
        function drawConnections() {
            const svg = document.getElementById('connections-layer');
            const container = document.querySelector('.hero-architecture');
            if (!svg || !container) return;

            while (svg.firstChild) { svg.removeChild(svg.firstChild); }
            const cRect = container.getBoundingClientRect();

            function getCenter(id) {
                const el = document.getElementById(id);
                if (!el) return null;
                const r = el.getBoundingClientRect();
                return {
                    x: (r.left + r.width / 2) - cRect.left,
                    y: (r.top + r.height / 2) - cRect.top,
                    w: r.width, h: r.height,
                    top: r.top - cRect.top,
                    bottom: r.bottom - cRect.top,
                    left: r.left - cRect.left,
                    right: r.right - cRect.left
                };
            }

            function drawPath(id1, id2, type = 'curve', label = null, labelOffset = { x: 0, y: 0 }) {
                const p1 = getCenter(id1);
                const p2 = getCenter(id2);
                if (!p1 || !p2) return;

                let d = '';
                // Default label position (midpoint)
                let lx = (p1.x + p2.x) / 2;
                let ly = (p1.y + p2.y) / 2;

                if (type === 'curve') {
                    const deltaX = p2.x - p1.x;
                    const c1x = p1.x + deltaX * 0.5;
                    const c2x = p2.x - deltaX * 0.5;
                    d = `M ${p1.x} ${p1.y} C ${c1x} ${p1.y}, ${c2x} ${p2.y}, ${p2.x} ${p2.y}`;
                    // Curve midpoint calculation is complex, but geometric mid is usually okay with offset.
                    // Let's bias Y up slightly for curves that dip.
                    ly = p1.y + (p2.y - p1.y) * 0.5;
                    if (Math.abs(p1.y - p2.y) < 20) ly -= 10; // If mostly horizontal, push label up

                } else if (type === 'step') {
                    const midY = (p1.y + p2.y) / 2;
                    d = `M ${p1.x} ${p1.y} L ${p1.x} ${midY} L ${p2.x} ${midY} L ${p2.x} ${p2.y}`;

                    // For 'step', place label on the horizontal bar
                    lx = (p1.x + p2.x) / 2;
                    ly = midY - 5;

                } else if (type === 'straight') {
                    // Vertical straight (default)
                    d = `M ${p1.x} ${p1.bottom} L ${p2.x} ${p2.top}`;
                    ly = (p1.bottom + p2.top) / 2;
                    lx = (p1.x + p2.x) / 2;

                } else if (type === 'straight-horizontal') {
                    // Horizontal straight (Left to Right)
                    d = `M ${p1.right} ${p1.y} L ${p2.left} ${p2.y}`;
                    ly = (p1.y + p2.y) / 2 - 10; // Slightly above line
                    lx = (p1.right + p2.left) / 2;

                } else if (type === 'loop') {
                    // Centered Loop: Arch above the box
                    const startX = p1.x;
                    const startY = p1.top;
                    // Draw a loop that goes up-left, curves around top, comes down-right
                    d = `M ${startX - 10} ${startY} 
                          C ${startX - 40} ${startY - 30}, ${startX - 40} ${startY - 50}, ${startX} ${startY - 50}
                          C ${startX + 40} ${startY - 50}, ${startX + 40} ${startY - 30}, ${startX + 10} ${startY}`;

                    lx = startX;
                    ly = startY - 55; // On top of the loop
                }

                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', d);
                path.setAttribute('class', 'connection-line');
                if (type === 'straight-horizontal') path.style.strokeDasharray = "5,5";
                svg.appendChild(path);

                const packet = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                packet.setAttribute('r', '3');
                packet.setAttribute('class', 'connection-packet');
                const anim = document.createElementNS('http://www.w3.org/2000/svg', 'animateMotion');
                anim.setAttribute('dur', '2s');
                anim.setAttribute('repeatCount', 'indefinite');
                anim.setAttribute('path', d);
                packet.appendChild(anim);
                svg.appendChild(packet);

                if (label) {
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');

                    // Apply Manual Offset
                    lx += labelOffset.x;
                    ly += labelOffset.y;

                    text.setAttribute('x', lx);
                    text.setAttribute('y', ly);
                    text.setAttribute('class', 'connection-label');
                    text.setAttribute('text-anchor', 'middle');

                    // Add background rect? For now just text.
                    text.textContent = label;
                    svg.appendChild(text);
                }
            }

            // Draw all
            // YouTube -> Collection (Download)
            drawPath('node-yt', 'node-collection', 'step', 'Download');

            drawPath('node-collection', 'node-collection', 'loop', 'Daily Cron');
            drawPath('node-collection', 'node-s3', 'curve', 'Filter Data', { x: 0, y: -5 });

            // S3 -> WB
            drawPath('node-s3', 'node-wb', 'curve', 'Visualization', { x: 0, y: -5 });

            drawPath('node-s3', 'node-dvc', 'step', 'Dataset Versioning', { x: 5, y: -5 });

            // DVC -> Train: "On New Dataset Release". 'step' puts it on midY horizontal.
            // User wants it "more on left".
            drawPath('node-dvc', 'node-train', 'step', 'On New Dataset Release', { x: -10, y: -5 });

            // Registry -> Train: "Build" (Actually, usually it's Code -> Build -> Registry. But per user request:)
            // Left of Train. 
            drawPath('node-reg', 'node-train', 'step', 'Build', { x: 0, y: -5 });

            // Train -> RunPod
            drawPath('node-train', 'node-runpod', 'step', 'Submit Job', { x: 5, y: 0 });

            // RunPod -> WB (Register)
            drawPath('node-runpod', 'node-wb', 'curve', 'Register', { x: 0, y: -5 });

            // Testing Pipeline Loop
            drawPath('node-human', 'node-human', 'loop', 'On New Candidate Model', { x: 0, y: 0 });

            // Testing -> Monitoring
            drawPath('node-human', 'node-mon', 'straight-horizontal', 'Notify', { x: 0, y: 0 });

            // Human -> WB
            drawPath('node-human', 'node-wb', 'straight', 'Promote to Prod', { x: 10, y: 0 });

            // Testing -> RunPod (Execution environment)
            drawPath('node-human', 'node-runpod', 'curve', 'Executes On', { x: 0, y: 0 });

            // WB -> Inf: 'Deploy Static'. Center it.
            drawPath('node-wb', 'node-inf', 'step', 'Deploy', { x: 0, y: -5 });
        }


        // Wait for layout to be stable
        window.addEventListener('load', () => {
            requestAnimationFrame(drawConnections);
        });
        window.addEventListener('resize', () => {
            requestAnimationFrame(drawConnections);
        });
        // Periodic check to ensure they don't disappear
        setInterval(drawConnections, 2000);
    </script>
</body>